!function(e){"use strict";theme.SearchAjax=function(){function t(){this.selectors={search:".js-search-ajax"},this.load()}t.prototype=e.extend({},t.prototype,{load:function(){function t(t,s,a){if(a.count>0){var r=e(e("#template-search-ajax")[0].content),n=e(document.createDocumentFragment()),i=+t.attr("data-js-max-products")-1;e.each(a.results,function(e){var t=r.clone(),s=t.find(".product-search-2__image img"),a=t.find(".product-search-2__title a"),c=t.find(".product-search-2__price .price"),o=t.find("a");return o.attr("href",this.url),a.html(this.title),this.thumbnail?s.attr("srcset",this.thumbnail+" 1x, "+this.thumbnail2x+" 2x"):s.remove(),c.length&&(this.price?theme.ProductCurrency.setPrice(c,this.price,this.compare_at_price):c.remove()),n.append(t),e<i}),s.html(""),s.append(n),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update()}else s.html("");s[a.count>0?"removeClass":"addClass"]("d-none-important")}function s(s,r,n,i){var c=s.find(".search-ajax__result"),o=s.find(".search-ajax__view-all"),u=o.find("a"),l=s.find(".search-ajax__empty");u.attr("href",theme.routes.search_url+"?q="+n+"&options[prefix]=last"),o[i.count>0?"removeClass":"addClass"]("d-none-important"),l.html(theme.strings.general.search.no_results_html.replace("{{ terms }}",n))[""===n||i.count>0?"addClass":"removeClass"]("d-none-important"),c.addClass("invisible"),t(s,c,i),c.removeClass("invisible"),theme.Loader.unset(r),s.find('button[type="submit"]').removeClass("disabled"),s.addClass("open"),$body.unbind("click.search-ajax"),$window.unbind("scroll.search-ajax"),$body.on("click.search-ajax",function(t){e(t.target).parents(".js-search-ajax").length||(a(),$body.unbind("click.search-ajax"))}),$window.on("scroll.search-ajax",function(){a(),$window.unbind("scroll.search-ajax")})}function a(t){var a=t||e(n.selectors.search),r=a.find(".search-ajax__content");i="",a.find("input").val(""),s(a,r,i,{count:0}),a.removeClass("open")}var r,n=this,i="";$body.on("keyup",this.selectors.search+" input",e.debounce(500,function(t){var a=e(this).parents(n.selectors.search);if(27!==t.keyCode){var c=e(this),o=c.val(),u=a.find(".search-ajax__content");o!==i&&(i=o,""===i?s(a,u,i,{count:0}):(r&&r.abort(),theme.Loader.set(u),a.find('button[type="submit"]').addClass("disabled"),r=e.getJSON({url:theme.routes.search_url+"/suggest.json",type:"GET",data:{q:i,resources:{type:"product,page",unavailable_products:"last",fields:"title,vendor,product_type,variants.title",options:null}},success:function(t){var r=5,n={count:Math.min(t.resources.results.products.length+t.resources.results.pages.length,r),results:[]},c=0;e.each(t.resources.results.products,function(){return!(c>r)&&(n.results.push({price:parseInt(this.price_min.replace(".","")),compare_at_price:parseInt(this.compare_at_price_min.replace(".","")),thumbnail:Shopify.resizeImage(this.image,"200x"),thumbnail2x:Shopify.resizeImage(this.image,"200x@2x"),title:this.title,url:this.url}),void c++)}),e.each(t.resources.results.pages,function(){return!(c>r)&&(n.results.push({title:this.title,url:this.url}),void c++)}),s(a,u,i,n)}})))}})),$body.on("keyup",this.selectors.search+" input",function(t){if(27===t.keyCode){var a=e(this).parents(n.selectors.search),r=a.find(".search-ajax__content");i="",s(a,r,i,{count:0})}}),$body.on("clear",this.selectors.search,function(){a(e(this))})},closeAll:function(){e(this.selectors.search+".open").trigger("clear")}}),theme.SearchAjax=new t},e(function(){theme.SearchAjax()})}(jQueryTheme);