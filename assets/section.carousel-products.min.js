!function(t){"use strict";theme.CarouselProducts=function(){function e(e){this.$container=t(e),this.namespace=".carousel-products",this.onLoad()}return e.prototype=t.extend({},Section.prototype,e.prototype,{_checkProduct:function(e,a){var o=this,i=e.attr("data-handle");return!!i&&(a&&a(e),t.ajax({type:"GET",url:theme.routes.root_url+"products/"+i,data:{view:"collection"},cache:!1,dataType:"html",success:function(a){var n=t(a);e.add(o.$slick.find('.slick-cloned[data-handle="'+i+'"]')).html(n).removeAttr("data-handle"),theme.ImagesLazyLoad.update(),theme.ProductCountdown.init(e.find(".js-countdown")),e.trigger("loaded")}}),!0)},initCarousel:function(){function e(){var e=0;s.find(".carousel__item img").each(function(){e=Math.max(e,t(this).innerHeight())}),f.css({top:e/2})}function a(){s.one("init",function(){g&&e(),t(window).trigger("checkImages"),n.removeClass("invisible"),theme.Loader.unset(n.parent())}),s.on("beforeChange",function(t,e,a,o){function n(t){u.unbind("loaded"),t.one("loaded",function(){theme.ProductReview.update()})}var r=o-1,d=o+p;i._checkProduct(s.find('[data-slick-index="'+r+'"]'),n);for(var c=d;c>a+1;c--)i._checkProduct(s.find('[data-slick-index="'+c+'"]'),n)}),s.on("afterChange",function(){theme.Tooltip&&theme.Tooltip.init()}),s.slick({lazyLoad:!1,arrows:g,prevArrow:h,nextArrow:m,dots:y,dotsClass:"slick-dots d-flex flex-wrap flex-center list-unstyled mt-7",adaptiveHeight:!0,autoplay:v,autoplaySpeed:w,infinite:k,slidesToShow:p,slidesToScroll:p,rtl:theme.rtl,responsive:[{breakpoint:theme.breakpoints.values.xl,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:theme.breakpoints.values.md,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:theme.breakpoints.values.sm,settings:{slidesToShow:2,slidesToScroll:2}}]})}function o(e,o){l&&l.abort(),o&&(theme.Loader.set(n),n.css({"min-height":c.innerHeight()}));var i=e.attr("data-collection");l=t.ajax({type:"GET",url:"/collections/"+i,cache:!1,data:{view:"carousel",max_count:c.attr("data-max-count"),size_of_columns:c.attr("data-products-pre-row"),async_ajax_loading:c.attr("data-async-ajax-loading")},dataType:"html",success:function(t){n.addClass("invisible"),s.hasClass("slick-initialized")&&s.slick("destroy").off(),s.one("init",function(){n.removeAttr("style"),o&&theme.Loader.unset(n)}),c.html(t),u=s.find("> *"),a(),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update(),theme.ProductCountdown.init(c.find(".js-countdown")),theme.ProductReview.update(),theme.Tooltip&&theme.Tooltip.init(),r.find("a").removeClass("active"),e.addClass("active"),l=null}})}var i=this,n=this.$container.find("[data-js-carousel]"),s=this.$container.find("[data-js-carousel-slick]"),r=this.$container.find("[data-carousel-control]"),d=this.$container.find("[data-carousel-ajax] [data-collection]"),c=this.$container.find("[data-carousel-items]"),l=null;if(this.$control=r,s.length){var u=s.find("> *"),h=n.find("[data-js-carousel-prev]"),m=n.find("[data-js-carousel-next]"),f=h.add(m),p=+n.attr("data-count"),v="true"===n.attr("data-autoplay"),w=+n.attr("data-speed")||0,k="true"===n.attr("data-infinite"),g="true"===n.attr("data-arrows"),y="true"===n.attr("data-bullets");this.$slick=s,g&&$window.on("theme.resize.carousel-products",e),d.length?o(d.first()):a(),r.on("click","a",function(e){var a=t(this);return a.hasClass("active")||o(a,!0),e.preventDefault(),!1})}},onLoad:function(){var e,a,o=this,i=this.$container.find(".product-recommendations");i.length?(e=i.attr("data-product-id"),a=i.attr("data-limit"),t.ajax({type:"GET",url:theme.routes.root_url+"recommendations/products",data:{section_id:"carousel-related-products",product_id:e,limit:a},success:function(e){i.html(t(e).find(".product-recommendations").html()),o.initCarousel(),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update(),theme.ProductCountdown.init(i.find(".js-countdown")),theme.ProductReview.update(),theme.Tooltip&&theme.Tooltip.init()}})):this.initCarousel()},onUnload:function(){this.$container.off(this.namespace),this.$slick&&(this.$slick.slick("destroy").off(),this.$slick=null,$window.unbind("theme.resize.carousel-products")),this.$control.off()}}),e}(),t(function(){theme.sections.register("carousel-products",theme.CarouselProducts)})}(jQueryTheme);