!function($){"use strict";theme.Collections=function(){function Collections(){var e=$(".js-collections");this.dom={$collections:e,$body:e.find("[data-js-collections-body]"),$sidebar:$("[data-js-collection-sidebar]"),$pagination:e.find("[data-js-collection-pagination]")},this.current={xhr:null,handle:null},this.dom.$collections.length&&this.load()}Collections.prototype=$.extend({},Collections.prototype,{_parseURL:function(){var e=window.location.href,a=e.split(theme.routes.collections_url+"/")[1].split("?"),n=a[0].split("/"),t=a[1]?a[1].split("&"):void 0,o={handle:n[0],params:{tags:[],vendors:[],types:[],options:[],title:null,price_from:null,price_to:null,only_available_enable:null,logic_or_enable:null,page:null,view:null,sort_by:null}};return n[1]&&(o.params.tags=o.params.tags.concat(n[1].split("+"))),$.each(t,function(e,a){var n=a.split("="),t=n[0],l=n[1];"constraint"===t?l.split("+").map(function(e){o.params.tags.push(decodeURIComponent(e))}):"q"===t?$.each(l.split("+"),function(e,a){var n=a.split("_:"),t=n[0],l=n[1];"tg"===t?o.params.tags.push(decodeURIComponent(l)):"vd"===t?o.params.vendors.push(decodeURIComponent(l)):"tp"===t?o.params.types.push(decodeURIComponent(l)):"opt"===t?(l=l.split("::"),o.params.options.push(decodeURIComponent(l[0])+"::"+decodeURIComponent(l[1]))):"tt"===t?o.params.title=decodeURIComponent(l):"prf"===t?o.params.price_from=l:"prt"===t?o.params.price_to=l:"oa"===t?o.params.only_available_enable="true"===l||"false"!==l&&null:"lo"===t?o.params.logic_or_enable="true"===l||"false"!==l&&null:"pg"===t&&(o.params.page=l)}):"view"===t?o.params.view=l:"sort_by"===t?o.params.sort_by=l:"page"===t&&(o.params.page=l)}),o},_buildURL:function(e){function a(e,a){for(var n,t=[],o=0;o<e.length;o++)a?(n=e[o].split(a),t[o]=encodeURIComponent(n[0])+a+encodeURIComponent(n[1])):t[o]=encodeURIComponent(e[o]);return t}var n=theme.routes.collections_url+"/"+e.handle,t=n,o=[],l=[];return window.page.default.only_available===!0||window.page.default.logic_or===!0||e.params.vendors.length||e.params.types.length||e.params.options.length||null!==e.params.title||null!==e.params.price_from||null!==e.params.price_to||null!=e.params.only_available_enable||null!=e.params.logic_or_enable?(o[0]=[],e.params.tags.length&&o[0].push("tg_:"+a(e.params.tags).join("+tg_:")),e.params.vendors.length&&o[0].push("vd_:"+a(e.params.vendors).join("+vd_:")),e.params.types.length&&o[0].push("tp_:"+a(e.params.types).join("+tp_:")),e.params.options.length&&o[0].push("opt_:"+a(e.params.options,"::").join("+opt_:")),null!==e.params.title&&o[0].push("tt_:"+encodeURIComponent(e.params.title)),null!==e.params.price_from&&o[0].push("prf_:"+e.params.price_from),null!==e.params.price_to&&o[0].push("prt_:"+e.params.price_to),null!==e.params.only_available_enable&&e.params.only_available_enable!==window.page.default.only_available&&o[0].push("oa_:"+e.params.only_available_enable),null!==e.params.logic_or_enable&&e.params.logic_or_enable!==window.page.default.logic_or&&o[0].push("lo_:"+e.params.logic_or_enable),null!==e.params.page&&1!==e.params.page&&o[0].push("pg_:"+e.params.page),o[0].length?o[0]="q="+o[0].join("+"):o=[]):(e.params.tags.length&&o.push("constraint="+a(e.params.tags).join("+")),null!==e.params.page&&1!==e.params.page&&o.push("page="+e.params.page)),null!==e.params.sort_by&&e.params.sort_by!==window.page.default.sort_by&&o.push("sort_by="+e.params.sort_by),l=o.slice(),null!==e.params.view&&e.params.view!==window.page.default.view_length?(o.push("view="+e.params.view),l.push("view="+e.params.view+"-ajax")):l.push("view=ajax"),o.length&&(n+="?"+o.join("&")),t+="?"+l.join("&"),{history:n,ajax:t}},_changeURL:function(e,a){("onchange.pagination"!==a||"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type)&&history.pushState({foo:"filters"},e,e)},_changeObj:function(e,a,n,t){var o,l=$.extend(!0,{},e),r=l;return a.indexOf("params.")!==-1&&(r=l.params,a=a.replace("params.","")),"change"===n?r[a]=t:"add"===n?r[a].indexOf(t)===-1&&r[a].push(t):"remove"===n&&(o=r[a].indexOf(t),o!==-1&&r[a].splice(o,1)),l},_setControls:function(e){var a=window.page.default.only_available,n=window.page.default.logic_or;null!==e.params.only_available_enable&&(a=e.params.only_available_enable),null!==e.params.logic_or_enable&&(n=e.params.logic_or_enable),$('[name="collection"]').prop("checked",!1).filter('[value="'+e.handle+'"]').prop("checked","checked"),$('[name="collection_with_tag"], [name="filter_by_tag"], [name="filter_by_color"], [name="filter_by_vendor"], [name="filter_by_type"], [name="filter_by_option"]').prop("checked",!1),$('[name="filter_by_title"]').val(""),theme.RangeOfPrice&&theme.RangeOfPrice.reset(),$.each(e.params.tags,function(e,a){$('[name="collection_with_tag"][value="'+a+'"]').prop("checked","checked"),$('[name="filter_by_tag"][value="'+a+'"]').prop("checked","checked"),$('[name="filter_by_color"][value="'+a+'"]').prop("checked","checked")}),$.each(e.params.vendors,function(e,a){$('[name="filter_by_vendor"][value="'+a+'"]').prop("checked","checked")}),$.each(e.params.types,function(e,a){$('[name="filter_by_type"][value="'+a+'"]').prop("checked","checked")}),$.each(e.params.options,function(e,a){$('[name="filter_by_option"][value="'+a+'"]').prop("checked","checked")}),$('[name="filter_by_title"]').val(e.params.title?e.params.title:""),$('[name="only_available"]').prop("checked",!!a&&"checked"),$('[name="logic_or"]').prop("checked",!!n&&"checked"),$('[name="sort_by"]').val(null!==e.params.sort_by?e.params.sort_by:window.page.default.sort_by).trigger("update"),$('[name="view_length"]').val(null!==e.params.view?e.params.view:window.page.default.view_length).trigger("update"),theme.RangeOfPrice&&theme.RangeOfPrice.update(e.params.price_from,e.params.price_to)},_loadContent:function(url,obj,event){var _=this;this.current.xhr&&this.current.xhr.abort(),theme.Loader.set($('[data-js-collection-replace="products"]').parent(),{fixed:!0,spinner:!theme.current.is_mobile&&null}),this.xhr=$.ajax({type:"GET",url:url,cache:!1,dataType:"html",success:function(data){var parser=new DOMParser,$new_page=$(parser.parseFromString(data,"text/html")),replace_find="[data-js-collection-replace]";theme.ProductsView&&theme.ProductsView.update($new_page.find("[data-js-products]")),_.current.handle===obj.handle&&(replace_find+=":not([data-js-collection-replace-only-full])"),$(replace_find).each(function(){var $this=$(this),name=$this.attr("data-js-collection-replace"),$element=$('[data-js-collection-replace="'+name+'"]'),$page_element=$new_page.find('[data-js-collection-replace="'+name+'"]'),$section;"onchange.pagination"!==event||"products"!==name||"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type?($element.replaceWith($page_element),$page_element[0].hasAttribute("data-js-collection-manual-visible")&&$page_element.parents("[data-js-collection-manual-visible-section]")["true"===$page_element.attr("data-js-collection-manual-visible")?"removeClass":"addClass"]("d-none-important"),$page_element[0].hasAttribute("data-js-collection-replace-hide-empty")&&($section=$page_element.parents("[data-js-collection-nav-section]"),$section[$page_element.find("input, [data-filter-type]").length?"removeClass":"addClass"]("d-none")),"fullwidth-head"===name||"head"===name?$page_element.parents("[data-section-type]").trigger("section:reload"):"products"===name?theme.Loader.unset($page_element.parent()):"js-settings"==name&&eval($page_element.text()),$element.remove()):($element.append($page_element.children()),"products"===name&&theme.Loader.unset($element.parent()))}),_.current.handle!==obj.handle&&($new_page.find("[data-js-collection-visible-element]").each(function(){var e=$(this),a=e.attr("data-js-collection-visible-element");$('[data-js-collection-visible-element="'+a+'"]')["true"===e.attr("data-js-collection-visible")?"removeClass":"addClass"]("d-none-important")}),null===obj.params.sort_by&&_.dom.$body.find('[name="sort_by"]').val(window.page.default.sort_by).trigger("update"),null===obj.params.view&&_.dom.$body.find('[name="view_length"]').val(window.page.default.view_length).trigger("update")),_.dom.$pagination=_.dom.$body.find("[data-js-collection-pagination]"),theme.current.is_mobile&&theme.Loader.unset(_.dom.$sidebar),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update(),theme.StoreLists.checkProductStatus(),theme.ProductCountdown.init(_.dom.$body.find(".js-countdown")),theme.ProductReview.update(),theme.Tooltip&&theme.Tooltip.init(),$new_page.remove(),_.current.handle=obj.handle,_.current.xhr=null}})},_onChangeHistory:function(e){var a=this._buildURL(e);theme.current.is_mobile&&theme.Loader.set(this.dom.$sidebar,{fixed:!0}),this._setControls(e),this._loadContent(a.ajax,e)},_onChangeControls:function(e,a){var n=this._buildURL(e);theme.current.is_mobile&&theme.Loader.set(this.dom.$sidebar,{fixed:!0}),window.page.default.reload_type_ajax===!0?(this._changeURL(n.history,a),this._loadContent(n.ajax,e,a)):window.location.href=n.history},changePriceParams:function(e,a){var n=this._parseURL(),t=$.extend(!0,{},n);t=this._changeObj(t,"params.price_from","change",e),t=this._changeObj(t,"params.price_to","change",a),this._onChangeControls(t)},load:function(){function e(e,a){var t=n._parseURL(),o=$.extend(!0,{},t),l=n.dom.$sidebar.find('[name="collection"]:checked').val();o=n._changeObj(o,"handle","change",l),o=n._changeObj(o,"params.page","change",null),e?(o=n._changeObj(o,"params.tags","change",[]),o=n._changeObj(o,"params.vendors","change",[]),o=n._changeObj(o,"params.types","change",[]),o=n._changeObj(o,"params.options","change",[]),o=n._changeObj(o,"params.title","change",null),o=n._changeObj(o,"params.price_from","change",null),o=n._changeObj(o,"params.price_to","change",null),$("[data-js-collection-current-tags] [data-filter-type]").remove(),$('[name="collection_with_tag"], [name="filter_by_tag"], [name="filter_by_color"], [name="filter_by_vendor"], [name="filter_by_type"], [name="filter_by_option"]').prop("checked",!1),$('[name="filter_by_title"]').val(""),theme.RangeOfPrice&&theme.RangeOfPrice.reset()):n.dom.$sidebar.find('[name="collection_with_tag"]').each(function(){var e=$(this),a=e.val();o=e.is(":checked")?n._changeObj(o,"params.tags","add",a):n._changeObj(o,"params.tags","remove",a)}),a&&a(o),n._onChangeControls(o)}function a(){var e=n._parseURL(),a=$.extend(!0,{},e),t=n.dom.$sidebar.find('[name="filter_by_title"]').val();a=n._changeObj(a,"params.page","change",null),a=t.length?n._changeObj(a,"params.title","change",t):n._changeObj(a,"params.title","change",null),n._onChangeControls(a)}var n=this;this.dom.$sidebar.on("change",'[name="collection"]',function(){e(!0)}),this.dom.$sidebar.on("change",'[name="collection_with_tag"]',function(){var a=$(this),t=a.parents(".collections-menu__item").find('[name="collection"]'),o=$('[name="collection"]').not(t),l=t.is(":checked");o.prop("checked",!1),t.prop("checked","checked"),e(!l,function(e){l||(a.prop("checked","checked"),e=$.extend(!0,e,n._changeObj(e,"params.tags","add",a.val())))})}),this.dom.$sidebar.on("change",'[name="filter_by_tag"], [name="filter_by_color"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this),o=t.val();a=n._changeObj(a,"params.page","change",null),a=t.is(":checked")?n._changeObj(a,"params.tags","add",o):n._changeObj(a,"params.tags","remove",o),n._onChangeControls(a)}),this.dom.$sidebar.on("change",'[name="filter_by_vendor"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this),o=t.val();a=n._changeObj(a,"params.page","change",null),a=t.is(":checked")?n._changeObj(a,"params.vendors","add",o):n._changeObj(a,"params.vendors","remove",o),n._onChangeControls(a)}),this.dom.$sidebar.on("change",'[name="filter_by_type"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this),o=t.val();a=n._changeObj(a,"params.page","change",null),a=t.is(":checked")?n._changeObj(a,"params.types","add",o):n._changeObj(a,"params.types","remove",o),n._onChangeControls(a)}),this.dom.$sidebar.on("change",'[name="filter_by_option"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this),o=t.val();a=n._changeObj(a,"params.page","change",null),a=t.is(":checked")?n._changeObj(a,"params.options","add",o):n._changeObj(a,"params.options","remove",o),n._onChangeControls(a)}),this.dom.$sidebar.on("change",'[name="only_available"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this);a=n._changeObj(a,"params.page","change",null),a=n._changeObj(a,"params.only_available_enable","change",t.is(":checked")),n._onChangeControls(a)}),this.dom.$sidebar.on("change",'[name="logic_or"]',function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this);a=n._changeObj(a,"params.page","change",null),a=n._changeObj(a,"params.logic_or_enable","change",t.is(":checked")),n._onChangeControls(a)}),this.dom.$sidebar.on("click","[data-js-collection-filter-by-title] button",function(){a()}),this.dom.$sidebar.on("keyup","[data-js-collection-filter-by-title] input",$.debounce(700,function(){a()})),this.dom.$sidebar.on("click","[data-js-collection-current-tags] [data-filter-type]",function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this),o=$(this).attr("data-filter-type"),l=t.attr("data-value");a=n._changeObj(a,"params.page","change",null),"tg"===o?a=n._changeObj(a,"params.tags","remove",l):"vd"===o?a=n._changeObj(a,"params.vendors","remove",l):"tp"===o?a=n._changeObj(a,"params.types","remove",l):"opt"===o?a=n._changeObj(a,"params.options","remove",l):"tt"===o?a=n._changeObj(a,"params.title","change",null):"pr"===o&&(a=n._changeObj(a,"params.price_from","change",null),a=n._changeObj(a,"params.price_to","change",null)),n._setControls(a),n._onChangeControls(a),t.remove()}),this.dom.$sidebar.on("click","[data-js-collection-current-tags-clear]",function(){var e=n._parseURL(),a=$.extend(!0,{},e);a=n._changeObj(a,"params.tags","change",[]),a=n._changeObj(a,"params.vendors","change",[]),a=n._changeObj(a,"params.types","change",[]),a=n._changeObj(a,"params.options","change",[]),a=n._changeObj(a,"params.title","change",null),a=n._changeObj(a,"params.price_from","change",null),a=n._changeObj(a,"params.price_to","change",null),a=n._changeObj(a,"params.page","change",null),n._setControls(a),n._onChangeControls(a),n.dom.$sidebar.find("[data-js-collection-current-tags] [data-filter-type]").remove()}),this.dom.$body.on("change","[data-js-collection-sort-by] select",function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this);a=n._changeObj(a,"params.page","change",null),a=n._changeObj(a,"params.sort_by","change",t.val()),n._onChangeControls(a)}),this.dom.$body.on("change","[data-js-collection-view-length] select",function(){var e=n._parseURL(),a=$.extend(!0,{},e),t=$(this);a=n._changeObj(a,"params.page","change",null),a=n._changeObj(a,"params.view","change",t.val()),n._onChangeControls(a)}),this.dom.$body.on("click","[data-js-collection-pagination] a",function(e){var a,t=n._parseURL(),o=$.extend(!0,{},t),l=$(this),r=l.attr("data-value")||l.attr("href").split("page=")[1].split("&")[0];return $('[name="page"]').val(r),o=n._changeObj(o,"params.page","change",r>1?r:null),n._onChangeControls(o,"onchange.pagination"),"button_load_more"!==window.page.default.pagination_type&&"infinite_scroll"!==window.page.default.pagination_type&&window.page.default.reload_type_ajax===!0&&(a=theme.StickyHeader&&theme.StickyHeader.$sticky?theme.StickyHeader.$sticky.stickyHeader("getStickyHeight"):0,$html.add($body).velocity("stop").velocity("scroll",{offset:n.dom.$body.find("[data-js-products]").offset().top-a,duration:1e3*theme.animations.pagination.scroll_duration})),e.preventDefault(),!1}),this.dom.$pagination.length&&"infinite_scroll"===window.page.default.pagination_type&&setTimeout(function(){$window.on("scroll",function(){var e=n.dom.$pagination[0].getBoundingClientRect();e.top<theme.current.height&&!n.dom.$pagination[0].hasAttribute("data-js-loading")&&(n.dom.$pagination.attr("data-js-loading",!0),n.dom.$pagination.find("a").trigger("click"))})},500),window.page.default.reload_type_ajax===!0&&$window.on("popstate",function(){var e=n._parseURL();n._onChangeHistory(e)})}}),theme.Collections=new Collections},$(function(){theme.Collections()})}(jQueryTheme);